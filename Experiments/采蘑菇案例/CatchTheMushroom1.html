<html>
<title>Blockly采蘑菇</title>
<meta name="author" content="zcf grade18 scut-softwareEngineering 2020-10-25"/>
<head>
  <title>Blockly</title>
  <!-- 这里是样式相关-->
  <link rel="stylesheet" href="css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/cj.css">
  <!-- js 脚本相关 -->
  <script src="js/jquery-3.5.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <!-- 与blockly有关的js脚本 -->
  <script src="js/blockly_compressed.js"></script>
  <script src="js/blocks_compressed.js"></script>
  <script src="js/python_compressed.js"></script>
  <script src="js/javascript_compressed.js"></script>
  <script src="js/zh-hans.js"></script>
  <!-- 与动画绘制相关的脚本-->
  <script src="js/canvas.js"></script>
  <!-- 自定义的js脚本-->
<!-- 在本处引入自定义blockly的js脚本，脚本文件存放位置在block_s下面, 本处为第一处要求-->
  <script src="block_s/block1_definitions.js"></script>
  <script src="block_s/block1_code.js"></script>
</head>
<body>
  <div class="container">
    <div class="main-wrp">
      <div class="row">
        <h2>采蘑菇catch the mushroom</h2>
        <hr/>
        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#btn_pro_bg" style="margin-left:20px;">
          问题描述
        </button>
        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#btn_pro_tip" style="margin-left:20px;">
          参考资料
        </button>
      </div>
      <div class="row">
        <div class="col-md-12 col-xs-12">
          <h2>Blockly</h2> 
          <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
<!-- 了解workspace和toolbox，本处为第二处要求点-->
          <xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"></xml>
          <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none"></xml>
        </div>
     </div>
     <div class="row">
        <div id="python-div" class="col-md-6 col-xs-12">
          <h2>Python Codes:</h2>
          <br/>
<!-- 了解workspace和toolbox，本处为第三处要求点-->
          <textarea  id="python-code" rows="20" cols="70" readonly></textarea><br>
        </div>
        <div class="col-md-6 col-xs-12">
          <h2>click ‘Run’ to eat the mushroom</h2>
          <br/>
<!-- 了解设置图片块，本处为第四处要求点-->
          <div id="gameMap"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3 col-xs-12" style="margin-top: 20px;" >
          <button id="trigger" class="btn btn-danger" type="button" onclick="enableKey()">KeyLock</button>
          <button class="btn btn-success" type="button" onclick="runcode()">Run</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="btn_pro_bg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">问题描述</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body cj-alert-box">
          <h2>复现案例</h2>
          <p>本例作为Blockly基本设置的考核</p>
          <p>要求一：利用js外部引用的相关知识点，引入对应的自定义Blockly文件，其文件为block_s文件夹下的block1_definitions.js和block1_code.js</p>
          <p>要求二：利用workspace和toolbox的相关知识点，设计toolbox</p>
          <p>要求三：利用代码生成相关知识，设计一个代码输出框</p>
          <p>要求四：利用canvas相关知识，设立一个动画演示框</p>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
  </div>
  <div class="modal fade " id="btn_pro_tip" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">参考资料</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body cj-alert-box">
          <h2>要求一</h2>
          <p>引入外部js:</p>
          <pre><code>
&lt;script &gt;src="block_s/block1_definitions.js" &lt;/script &gt;
&lt;script &gt;src="block_s/block1_code.js"&lt;/script&gt;          
          </code></pre>
          <h2>要求二</h2>
          <p>了解workspace和toolbox，利用blockly下的block1_definitions.js和Blockly Developer ToolsHelp 设计toolbox</p>
          <p>利用Blockly Developer ToolsHelp的代码生成工具生成workspace和toolbox代码</p>
          <p>注1:在本例中，拥有一个id为workspaceBlocks的xml（在46行附近）</p>
          <pre><code>
&lt;xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"&gt;&lt;/xml&gt;
          </code></pre>
          <p>而在js/workspace.js中获得了这个Element(js/workspace.js:大约在41行附近).</p>
          <pre><code>
var workspaceBlocks = document.getElementById("workspaceBlocks"); 
          </code></pre>
          <p>随后利用这个xml的内容初始化了workspace(js/workspace.js:大约在44行附近)</p>
          <pre><code>
Blockly.Xml.domToWorkspace(workspaceBlocks, workspace);
          </code></pre>
          
          <p>注2：在本例中，拥有一个id为toolbox的xml(在47行附近)</p>
          <pre><code>
&lt;xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none"&gt;&lt;/xml&gt;
          </code></pre>
          <p>而在js/workspace.js中获得了这个Element(js/workspace.js:大约在2行附近).</p>
          <pre><code>
var toolbox = document.getElementById("toolbox");
          </code></pre>
          <p>而在options中配置的时候使用了这个Element</p>
          <pre><code>
var options = { 
    toolbox : toolbox, 
    ...
}
          </code></pre>
          <p>接着inject接收一个参数blocklyDiv(这是一个div块，出现在本页面的44行）和一个参数option，然后初始化workspace(js/workspace.js:大约在36行附近)</p>
          <pre><code>
var workspaceBlocks = document.getElementById("workspaceBlocks"); 
          </code></pre>
          <p>显然，toolbox就是通过id为toolbox的xml进行改变的，也就是修改id为toolbox的xml可以改变toolbox</p>
          <p>自己设计toolbox的xml容易出现错误，可以通过Blockly Developer ToolsHelp来完成</p>
          <h2>要求三</h2>
          <p>了解textarea、id，理解myUpdateFunction函数</p>
          <p>变量workspace指向了一个workspace对象</p>
          <p>我们希望在workspace发生变化的时候做些事情</p>
          <p>这里的发生变化可以是我们添加、删除、移动了一个块</p>
          <p>我们可以做些事情，比如更新一下Python的代码显示</p>
          <p>首先，我们需要把代码从workspace中导出来, 然后展示到id为'python-code'的textarea(本页面的55行)里</p>
          <pre><code>
function myUpdateFunction(event) {
  var code = Blockly.Python.workspaceToCode(workspace);
  document.getElementById('python-code').value = code;
}
workspace.addChangeListener(myUpdateFunction);
          </code></pre>
          <h2>要求四</h2>
          <p>了解canvs、id，利用提供的cvs完成游戏动画的绘制</p>
          <p>在浏览器里运行JavaScript是比运行Python简单的，eval函数可以解析执行一段Javascript代码</p>
          <p>JavaScript 可以操作Canvas，不过Canvas并不是我们培训的主要内容，因此，与Canvas相关的部分只提供接口</p>
          <p>本例提供了一个cvs的canvas对象，可以通过appendChild的方式追加到gameMap标签下面</p>
          <pre><code>
function runcode(){
  var code = Blockly.JavaScript.workspaceToCode(workspace);
  eval(code);
}
document.getElementById("gameMap").appendChild(cvs); // 将新建的canvas渲染到页面
          </code></pre>
          <p>Blockly可以通过适配的方式实现代码到Python和代码和JavaScript的转化，而这同时也展示了不同语言的共性</p>
          <p>JavaScript可以在浏览器中顺利运行，但是浏览器不能直接运行Python代码，这体现了编程语言的差异</p>
          <strong>所以，欢迎来到Blockly的世界！</strong>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
  </div>
  <div id = "div_footer"> </div>
</body>
<!-- 本处为要求二、要求三、要求四-->
<script src="js/workspace.js"></script>
<script>
  function myUpdateFunction(event) {
      var code = Blockly.Python.workspaceToCode(workspace);
      document.getElementById('python-code').value = code;
  }
  workspace.addChangeListener(myUpdateFunction);
  function runcode(){
    var code = Blockly.JavaScript.workspaceToCode(workspace);
    console.log(code);
    eval(code);
  }
  document.getElementById("gameMap").appendChild(cvs); // 将新建的canvas渲染到页面
// console.log(ctx);
</script>
<script src="js/cj_footer.js"></script>
<script> load_footer("div_footer") </script>
</html>
 