<html>
<title>Blockly采蘑菇</title>
<meta name="author" content="zcf grade18 scut-softwareEngineering 2020-10-25"/>
<head>
  <link rel="stylesheet" href="css/bootstrap-grid.min.css">
    <link rel="stylesheet" href="css/bootstrap-reboot.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/cj.css">
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/blockly_compressed.js"></script>
    <script src="js/blocks_compressed.js"></script>
    <script src="js/python_compressed.js"></script>
    <script src="js/javascript_compressed.js"></script>
    <script src="js/zh-hans.js"></script>
    <script src="block_s/block_definitions.js"></script>
    <script src="block_s/block_code.js"></script>
</head>
<body>
  <div class="container">
    <div class="main-wrp">
      <div class="row">
        <h2>采蘑菇catch the mushroom:</h2>
        <hr/>
        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#btn_pro_bg" style="margin-left:20px;">
          问题描述
        </button>
        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#btn_pro_tip" style="margin-left:20px;">
          参考资料
        </button>
      </div>
      <div class="row">
        <div class="col-md-12 col-xs-12">
         <h2>Blockly</h1> 
          <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
          <xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"></xml>
          <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
              <category name="预置操作块" colour="#5b67a5">
                <block type="set_hero"></block>
                <block type="block_move">
                </block>
              </category>
            <category name="预置值块" colour="ed7684">
              <block type="block_direction">
              </block>
              <block type="block_hero"></block>
              <block type="math_number">
                <field name="NUM">0</field>
              </block>
              <block type="math_arithmetic">
                <field name="OP">ADD</field>
                <value name="A">
                  <shadow type="math_number">
                    <field name="NUM">1</field>
                  </shadow>
                </value>
                <value name="B">
                  <shadow type="math_number">
                    <field name="NUM">1</field>
                  </shadow>
                </value>
              </block>
              <block type="text"></block>
            </category>
            </xml>
     </div>
     </div>

     <div class="row">
       <div id="python-div" class="col-md-6 col-xs-12">
         <h2>Python Codes:</h2>
         <br>
         <textarea  id="python-code" rows="20" cols="70"></textarea><br>
       </div>
       <div class="col-md-6 col-xs-12">
        <h2>click ‘Run’ to eat the mushroom</h2>
        <pre id="output" ></pre>
         <div id="gameMap"></div>
         <script src="js/canvas.js"></script>
       </div>

     </div>
     <div class="row">
       <div class="col-md-3 col-xs-12" style="margin-top: 20px;" >
         <button id="trigger" class="btn btn-danger" type="button" onclick="enableKey()">KeyLock</button>
         <button class="btn btn-success" type="button" onclick="runcode()">Run</button>
       </div>
     </div>
    </div>
 </div>
  <div class="modal fade" id="btn_pro_bg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">问题描述</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <p>复现一个小游戏案例<br>
            ●涉及知识:canvas绘图、HTML5、JavaScript、Blockly自定义块及其代码、BlocklyFactory的使用、函数调用。
            在本案例中，核心的函数、布局、代码均已给出，运用所学的知识就足够完成此案例。<br>●已经实现的函数有:<br>
            &nbsp;&nbsp;1)changeHero【作用:修改英雄形象，参数1:一个代表图片地址的url字符串】;<br>
            &nbsp;&nbsp;2)move【作用:移动英雄,同时运行两个方向会有组合效果  参数1:移动方向(上下左右分别为1/2/3/4),参数2:步数,每步长度与英雄高度一致】<br>
            &nbsp;&nbsp;3)enableKey【作用:锁定/打开键盘WASD操作,无参数,可使用KeyLock按钮控制】</p>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
  </div>
  <div class="modal fade " id="btn_pro_tip" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">参考资料</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          
        </div>
        <div class="modal-body">
          <p>①在页面中嵌入游戏代码;<br>
            ②使用BlocklyFactory创建自定义功能块;<br>
            ③参考已实现函数加入自定义块的JavaScript打码;<br>
            ④给按钮添加运行函数;</p>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
  </div>
</body>

  <script src="js/workspace.js"></script>
<script>
  function myUpdateFunction(event) {
      var code = Blockly.Python.workspaceToCode(workspace);
      document.getElementById('python-code').value = code;
  }
  function runcode(){
    var code = Blockly.JavaScript.workspaceToCode(workspace);
    console.log(code);
    eval(code);
  }
  workspace.addChangeListener(myUpdateFunction);
  document.getElementById("gameMap").appendChild(cvs); // 将新建的canvas渲染到页面
</script>
</header>
</html>



 